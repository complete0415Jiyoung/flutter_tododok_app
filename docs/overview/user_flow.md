> ✅ 이 문서는 타자 연습 앱 Tododok의 전반적인 사용자 흐름을 비개발자 포함 누구나 이해할 수 있도록 정리한 내용입니다.
>
> 초기 실행부터 연습, 대결, 기록, 알림까지 모든 경로를 포괄합니다.

---

## 🔰 0. 앱 최초 실행 – 사용자 세팅

| 단계 | 설명 | 사용자 액션 | 시스템 처리 |
| --- | --- | --- | --- |
| 0.1 | 앱 실행 | 앱을 실행함 | Firebase 익명 로그인 자동 수행 |
| 0.2 | 사용자 정보 저장 | 없음 | Firestore users 문서 생성 |
| 0.3 | 알림 준비 | 없음 | FCM 토큰 저장 |
| 0.4 | 자판 기본값 설정 | 없음 | “한글”로 자동 설정 |
| 0.5 | 도전장 알림 설정 | 설정 가능 (기본 ON) | 설정에서 변경 가능 |
| 0.6 | 홈 화면 진입 | 기능 사용 시작 | 이후 모든 기능 사용 가능 |

---

## 🏠 1. 홈 화면 메뉴

| 메뉴 | 설명 |
| --- | --- |
| ✍️ **타자 연습** | 혼자서 단어/장문 연습 (기초 타자 연습) |
| 🥊 **친구 대결** | 도전장을 보내거나 받은 도전장을 수락 |
| 📊 **기록 보기** | 지난 연습 결과, 대결 결과, 통계 확인 |
| 🔔 **알림함** | 도전장 수락/결과 제출 등의 알림 목록 |
| ⚙️ **설정** | 자판 기본값 변경, 알림 수신 여부 설정 등 |

---

## ✍️ 2. 타자 연습 흐름

> 사용자가 혼자 타자 연습을 하는 과정입니다.
>
> 정확도/속도 등을 실시간으로 분석하며 연습하고, 결과는 기록됩니다.

| 단계 | 설명 |
| --- | --- |
| 2.1 | 연습 모드 선택 – `단어` 또는 `장문` 중 선택 |
| 2.2 | 연습할 문장 선택 – 또는 랜덤 추천 가능 |
| 2.3 | 자판 자동 설정 – `한글/영문` 기본값 적용 |
| 2.4 | 연습 진행 – WPM, 정확도, 오타 수 실시간 계산 |
| 2.5 | 연습 결과 요약 화면 표시 |
| 2.6 | 결과 저장 – Firestore에 기록됨 (`typing_results`) |
| ⭐ 2.7 | **[이 결과로 친구에게 도전] 버튼** → 도전장 생성으로 이어짐 |

---

## 🥊 3. 친구 대결 흐름

### A. 내가 도전하기

> 사용자가 직접 도전장을 생성하여 친구에게 보내는 과정입니다.

| 단계 | 설명 |
| --- | --- |
| 3A.1 | 연습 후 결과 기반 도전장 생성 |
| 3A.2 | 문장, 모드, 결과 포함하여 `challenges` 문서 생성 |
| 3A.3 | 도전장 공유용 링크 생성 (Firebase Dynamic Link) |
| 3A.4 | 친구에게 링크 공유 → 상태: `waiting` |

---

### B. 도전장 수락하기 (3가지 경로 지원)

> 친구가 보낸 도전장을 수락해 도전하는 흐름입니다.
>
> 3가지 경로 모두 `challengeId`를 기준으로 연습 화면으로 이동합니다.

| 진입 경로 | 설명 |
| --- | --- |
| 🧭 홈 > 친구 대결 > 도전장 수락 | 수락 가능한 도전장 목록을 보고 선택 |
| 🔔 알림함 | 수신된 도전장 알림을 클릭해서 진입 |
| 🔗 공유 링크 | 친구가 보낸 딥링크를 클릭해서 앱 실행 (자동 이동) |

### 🥊 도전장 수락 – 공통 흐름

| 단계 | 설명 |
| --- | --- |
| 3B.1 | challengeId로 도전장 조회 |
| 3B.2 | 문장 및 자판 자동 로딩 |
| 3B.3 | 동일 문장으로 연습 수행 |
| 3B.4 | 결과 제출 (resultTo 저장) |
| 3B.5 | 상태 변경 (completed) |
| 3B.6 | 승패 비교 결과 화면 표시 |
| 3B.7 | 도전자에게 FCM 알림 전송 |

---

## 📊 4. 기록 보기 흐름

> 사용자가 과거 자신의 타자 연습 기록 또는 대결 기록을 조회하는 과정입니다.

| 단계 | 설명 |
| --- | --- |
| 4.1 | 최근 연습/대결 결과 목록 조회 |
| 4.2 | 각 결과의 WPM, 정확도, 오타 수 확인 |
| 4.3 | 평균 정확도/속도 통계 제공 |
| 4.4 | (후속 예정) 월간 그래프 차트 등 시각화 기능 |

---

## 🔔 5. 알림함 흐름

> 도전장 수락/결과 제출 등의 알림을 확인하고 관련 화면으로 이동하는 흐름입니다.

| 단계 | 설명 |
| --- | --- |
| 5.1 | 알림함 진입 (홈에서 접근) |
| 5.2 | 알림 리스트 표시 (최신순 정렬) |
| 5.3 | 알림 클릭 시 해당 도전장 수락 화면으로 이동 (Go Router 딥링크 포함됨) |

---

## ⚙️ 6. 설정 페이지 흐름

> 사용자의 앱 환경 설정 관리

| 항목 | 설명 |
| --- | --- |
| 🔤 자판 설정 | 한글/영문 기본값 변경 |
| 🔔 알림 설정 | 도전장 관련 알림 수신 여부 설정 (단일 토글) |
| ℹ️ 기타 | 로그아웃, 피드백, 앱 버전 확인 등 |

---

## 🚨 예외 처리 흐름

| 상황 | 처리 방법 |
| --- | --- |
| 도전장 만료 | `status = "expired"`인 경우 → "만료된 도전장입니다" 안내 |
| 잘못된 링크 | 존재하지 않는 도전장 → 에러 안내 화면으로 이동 |
| 도전장 없음 | 수락 가능한 도전장이 없으면 "받은 도전장이 없어요" 문구 표시 |

---

## 🔑 흐름 요약

```
[앱 실행]
  ↓
[홈 화면]
  ├─ ✍️ 연습 → 결과 저장 + 도전장 보내기
  ├─ 🥊 대결 → 내가 도전 or 도전 수락 (목록/알림/링크)
  ├─ 📊 기록 보기
  ├─ 🔔 알림함 → 도전장 알림 확인
  └─ ⚙️ 설정 → 자판/알림 제어
```

---

## 📌 마무리 요약

- ✔️ **사용자는 연습 → 바로 도전장이 가능**
- ✔️ **도전장은 3가지 경로로 수락 가능** (홈/알림/딥링크)
- ✔️ **알림함으로 알림 기록도 관리 가능**
- ✔️ **설정에서 자판/알림 기본값 수정 가능**
- ✔️ **모든 정보는 Firestore 기반으로 일관성 있게 저장됨**